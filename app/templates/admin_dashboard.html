{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<h1 class="mb-3">First Aid Kit â€” Admin Dashboard</h1>

<!-- Manage User Points -->
<div class="card mb-4">
    <div class="card-header">
        <h3>Manage User Wallets</h3>
    </div>
    <div class="card-body">
        <form action="{{ url_for('manage_points') }}" method="POST" class="form-inline">
            <div class="form-group mb-2">
                <label for="user_id" class="sr-only">User</label>
                <select name="user_id" id="user_id" class="form-control" required>
                    <option value="">-- Select User --</option>
                    {% for user in users %}
                        <option value="{{ user.id }}">{{ user.username }} ({{ user.wallet_points }} points)</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group mx-sm-3 mb-2">
                <label for="points" class="sr-only">Points</label>
                <input type="number" class="form-control" id="points" name="points" placeholder="Points" required>
            </div>
            <div class="form-group mb-2">
                 <label for="action" class="sr-only">Action</label>
                 <select name="action" id="action" class="form-control">
                     <option value="add">Add</option>
                     <option value="deduct">Deduct</option>
                 </select>
            </div>
            <button type="submit" class="btn btn-primary ml-2 mb-2">Submit</button>
        </form>
    </div>
</div>

<!-- Users table -->
<h3>Users</h3>
<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>Username</th>
      <th>Email</th>
      <th>Points</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for user in users %}
      <tr>
        <td>{{ user.id }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.wallet_points }}</td>
        <td>
          <a href="{{ url_for('edit_user', user_id=user.id) }}" class="btn btn-sm btn-warning">Edit</a>
          <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" class="d-inline">
            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this user?');">Delete</button>
          </form>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Transactions -->
<h3 class="mt-4">Purchase History</h3>
<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>User</th>
      <th>Kits</th>
      <th>Points Deducted</th>
      <th>Timestamp</th>
      <th>Dispensed</th>
    </tr>
  </thead>
  <tbody>
    {% for tx in transactions %}
      <tr>
        <td>{{ tx.id }}</td>
        <td>{{ tx.user.username }}</td>
        <td>{{ tx.pads }}</td> <!-- internal field left as pads -->
        <td>{{ tx.points_deducted }}</td>
        <td>{{ tx.timestamp }}</td>
        <td>{{ 'Yes' if tx.dispensed else 'No' }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
